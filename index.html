<script>
    document.addEventListener("DOMContentLoaded", function() {
        const orderForm = document.getElementById("orderForm");
        const orderTable = document.getElementById("orderTable").querySelector("tbody");
        const completedOrders = document.getElementById("completedOrders").querySelector("tbody");
        const totalSales = document.getElementById("totalSales");
        let orders = JSON.parse(localStorage.getItem("orders")) || [];
        let completed = JSON.parse(localStorage.getItem("completed")) || [];

        function saveData() {
            localStorage.setItem("orders", JSON.stringify(orders));
            localStorage.setItem("completed", JSON.stringify(completed));
        }

        function renderTables() {
            orderTable.innerHTML = "";
            completedOrders.innerHTML = "";
            let salesTotal = 0;

            orders.forEach((order, index) => {
                let row = `<tr>
                    <td>${order.date}</td>
                    <td>${order.customerId}</td>
                    <td>${order.customerName}</td>
                    <td>${order.orderNumber}</td>
                    <td>$${order.saleAmount}</td>
                    <td>${order.orderStatus}</td>
                    <td>${order.notes}</td>
                    <td>
                        <button class="btn edit" onclick="editOrder(${index})">Edit</button>
                        <button class="btn delete" onclick="deleteOrder(${index})">Delete</button>
                        <button class="btn complete" onclick="completeOrder(${index})">Complete</button>
                    </td>
                </tr>`;
                orderTable.innerHTML += row;
            });

            completed.forEach(order => {
                salesTotal += parseFloat(order.saleAmount);
                let row = `<tr>
                    <td>${order.date}</td>
                    <td>${order.customerId}</td>
                    <td>${order.customerName}</td>
                    <td>${order.orderNumber}</td>
                    <td>$${order.saleAmount}</td>
                    <td>${order.notes}</td>
                </tr>`;
                completedOrders.innerHTML += row;
            });
            totalSales.textContent = salesTotal.toFixed(2);
        }

        window.deleteOrder = function(index) {
            orders.splice(index, 1);
            saveData();
            renderTables();
        };

        window.completeOrder = function(index) {
            completed.push(orders[index]);
            orders.splice(index, 1);
            saveData();
            renderTables();
        };

        window.editOrder = function(index) {
            let order = orders[index];
            document.getElementById("date").value = order.date;
            document.getElementById("customerId").value = order.customerId;
            document.getElementById("customerName").value = order.customerName;
            document.getElementById("orderNumber").value = order.orderNumber;
            document.getElementById("saleAmount").value = order.saleAmount;
            document.getElementById("orderStatus").value = order.orderStatus;
            document.getElementById("notes").value = order.notes;
            orders.splice(index, 1);
            saveData();
            renderTables();
        };

        // Add event listener for form submission
        orderForm.addEventListener("submit", function(event) {
            event.preventDefault();

            const newOrder = {
                date: document.getElementById("date").value,
                customerId: document.getElementById("customerId").value,
                customerName: document.getElementById("customerName").value,
                orderNumber: document.getElementById("orderNumber").value,
                saleAmount: parseFloat(document.getElementById("saleAmount").value).toFixed(2),
                orderStatus: document.getElementById("orderStatus").value,
                notes: document.getElementById("notes").value
            };

            orders.push(newOrder);
            saveData();
            renderTables();

            // Reset form fields after submission
            orderForm.reset();
        });

        renderTables();
    });
</script>
